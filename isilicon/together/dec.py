import base64
import hashlib
from Crypto import Random
from Crypto.Cipher import AES
import gmpy2

e = 0x10001
d = 0x4bb613fde1bcac5946d00dde72e71478eaa3e5959f2d298bd3bcd9cfa0ca766ff08166c3b37ba94b1c49ea9f145f8539107eda1c623610a39116dddeb8fc6f426b5da27e44ca6552516f016c3f1b7329e0096388c18aeca6f3d3daf75f864760947df0b9e836a521fd8d5e44f9ce4f1c72a1fdfab5808faf68c4ec4934e10f34635be7f5ef76eef414b4f901fd87afe8f034fdd854ee02d767392b9b57f448c4a2e8ac88095f1fd9fb7943c1cf2e92876fc049b9bd2efde725b25e2fe07761281a0312c6305329db77eee648a9854b63b2755d3ebe601a6b2d9ed40b8fdccb99a7ded4f9e89d20a0123687ff4159d8b6b4cf5a2a2553e1cf9efc91f6da99d4e26acf9132c4c14751966c88299410ef8dfad60c0a6241b54f30c22601a17662dc40099bee4cee2fc05819178b924f45dd58b92676ce8baaf3b13c64eedb06a6e85ebf0f1bab8159189c471276c47e11020172f1e573c75912ccb6933a2af3d28b3a24bf9aac8580a17f880656ccd6f39e313ba7ad0da7120aeba02d68f1307a61

p = 0xe23be65e9dd17aaf907aadaf6d03ed59637f1b79a695deabcf0ec7d18ce8372d9ebb4c51e8663eea8013402ffb0f97456fbdeff12753a23f4f6584004d05640916c690209eae954021ee46da103943d7fae1b41dd3cb4078bfc8e7b48a289e0fb9b52c113a449e126137bccfaed69efcfb873665d0e07f6301b3106a9779fbf1ce9bb669b545d224c65d49edea98a5ffdac27c23df8a32870ca8a933c357e2d0e04e55544154f6986037cfb49acb51014c1c0fc7b95aae302450402c3a1aa14d

q = 0xc309890be167aa54727c81b531fc0c9dc89dda17eb612158922e8040af0ccbabbebaddd4654c1375ff6d8ddbdd32bdc2e3279a2693fe128ca7c5edb2fe9840edc2ba101e0c0a13e449f39b034be1f3d0d00a053969801b9bb1fa7ee3a82654c4481a30161147f11347464595b461bdf3625529538daa3f809d870450583a59d39fc22136ce33dc36c3a1030fbf4252f4c21ceb88965e0d6f8f6d26ae199e8cbee2a0784ddfdae0940d3b036ff2639845bad681e86e6523cb84b38ef382a9ad6b

iqmp = 0x89db3f4f6f524c1953702ac4d15807f8e8b18c48c5e0de248a7c927d11a40676418a423f9dbe4809460d2f3434defba17308b0156527473a3c312aeb41b6937861f8abc9a51843dde96d178048fffb243b549b1b61634ad3a982e3c7e8e0775f7dfd1001ca61db309b41e344108f628aa894077083891111dc9f74be86060a2d1125b7fb2775c4904e1aee1c849312bc151d597cbc9bd47cfa415da213ff383ce39c83739155309998d3c905484217da9736a7664bb3143182adc26549a65e26

n = p*q

print hex(n)
#n = 3911489344995764796303029655372130938813158402681536435156153736435685482548510311133092559390893999159556208086885059667898975992115737485021819795664200150500091149198839117883082307354633079892424804769835654493969947320609867131491058692043697992020660004763557764957606280958248677419781077428832837907469832627207294424440237327221423713739449651217917773176367959504434363330503574429830194470389115135251362401411323334669474392044530537034680799989537749139920252430088607734146138725429832119167304339470918998490264504801418273540108486874208025769297423574752346215972922432177199879525577055196894650072497927582973492391511006347641981802158477157325628110432541524055078495185225542392067929604359670575164081028158160993265925710369315053670009858215508377090176453248002608381799212131122365980892983821432778321492851107603565109661968312969857115902749544042815777900898158100498380147649729082034518193199

d1 = gmpy2.invert(e, (p-1)*(q-1))

assert d==d1

iqmp1=gmpy2.invert(q,p)

print hex(iqmp)
print hex(iqmp1)

assert iqmp==iqmp1

iv = 0xf6ae15cec8afef6ed9f95ccf82200eaf


#key = pow(c,d,n)

#print hex(key)[2:-1].decode('hex')

ckey = 'Ds0sgd9hm2dSGIQsdG0KrXYMplTEIxChr2Qd+VZXcYwK408MXkE1FIXbvjAFaSYf1EHUGWuKy4lyP4H0I5upr97G8BceCbFwQnQJROOpvfGgpzwZbagG47Ys2M14saqnmEikOMi2evtAmuwFRGe8tHVfHiU8o8dlatft8XrEj/rcwJZxwC+6byAnvIEmSrMG/JwuYB5kdBEeqSh0lbgsJdgmiezzRB4LK47ubc8wEosbSBDIf4jqKJYSRs0HaDpxHUO/FVGypqkZhuv3EvS8KAcJoeMWSpKNgu7ZZu8yDM5xKFPWmYOGSIkunO2RgJceRMUkrII4wlviNEztqGHlEVnc9xlcICr6bGKFU8nB7l/G4SN+5MHe+JnGbsEdURV9ydX7u6A6kE/gZ78GYmYtKKCsrJnzdQchJLY9pUxtqdu+CUZ3cPJtRkQYoPpmFe/w+l8MmuZImMW+bVvAShjHC9hOttWSszd24onqw9o1tiptjsVCLcclGv9GGaByS4Fn'

ct = 'dQr9Tp/aySCCOharIqgaIBBrCyHLJR8KDak6e2iecJjm8hn4KQhzuRvnwrpXheddNe8pVktEZBQP1Y5XpQ+gX4f9pK3SLuVwKyBQU0RjZKCMXZB3oRbbK5mU8iZuI+XukhQ5Ju+sOIcbvMtSYBGh1M+WfY/tCsFdxwLSUlVCP+WorqYVi2EKAlS+16aKN2WOOqsRxJrnamZ1AT9HcFQga84P5vckoIU3d9TYh71uY1Q5t+H0M4PYms21q2mcKX2J6FslmmjFprrLLxFJGAuV928BjwRySnN+hYiHF4rxehPZIddBqul4QuYVKZIJpxFnh7nNGGDP9NFUJ8F3tosF7RHfc85QozUV6qNxKIGbxHD6jyPFhzAv27dhCNj0o98qdHvAnZBR1FdZqa5+QQ1lGW0VTyNbOSN6KVzeGfz+H3R/Nb5kH5n+5TDt8j6yA/juEmQq5vEfTLHsWaM8gR18Ts5KT9hlpuMg84fG/ferc/NWb7uGQ7sckCgth4AuOsz36V543KlZ/Yzyx+6uGAn8QfSasGABvnZlQ2gcXInAAO94jAd5AUuwfW+AFOfyLp/kIn4QKbWZ6LYW0TRRa70bo8RwgvivKesi5O/f5A458DRLXf3lTxF0+negS0Y2soSmTeiSxGhUx+e//G6D1ar5y00b53WeSxuy+vF1UWdp6lUMtJ/4+P0hyFwq8KGVovVB0arOaW5YxYYLHKeLbyWJUtQ2saeYayg1PBMYrw/ckLBDEn9H9O6LMQq/h21PipiRVKkBofBKfBwVqy4lQky+k914hMViXjzNiZJoIVtuc1XF+veX+aWpaiZJOzZZAc5eAdsTpaJV+cpSGcj9CAQPADzTmA/hGoRHP7jozZdRKyGnLxILWuRoG9Zn3cKFsrVmIX7mbxGMnJNa00ov9mOJuaayPOZRDErlM8cGfF2LvdX9FLgZSYpmsm0vNgTOZiuN/fgwLFkvuOVI+nP/RgXvf54ROyB/+AIvrXM/fAOWNCcd0q8YzV5Iz5ig89fkyULbrPooZUsF1cvaCul5SX4bIcH6obTHlUQiTgMCbLzYpd+RB0vaDfErjCH2urzpJUTEpDkkcXAWytPAL0cPODTyVaunEd8FP7d4aX18R90NW8ovYQewo/KwCy0IRoEp66YpEyidT8T9Zwo/1PFmaoG8xppqd4FlCold6pQWFOZLaq/jvC8zUnYySEJgEH2zXNL39GeWPnK/L/BSlJ2K3otHjjEUP0FC1NzaNE6o3WMFiXsvoBQSs1dVt3T1MBNYTlvs1I/4Ky7uWbM6CfRf8EAHNIYm3LUvbprYmy8V6fKRV5ihI2gJRfDT/XqXAIulp0hva8STIE262NW7ozxZT9X+/W43gfN/2vEykpZPWzoq6++0sBgXOuNj2mA3clk4beBMHlHSb56nzcc='

ckey = base64.b64decode(ckey)

#print ckey

ckey = 0x0ecd2c81df619b675218842c746d0aad760ca654c42310a1af641df95657718c0ae34f0c5e41351485dbbe300569261fd441d4196b8acb89723f81f4239ba9afdec6f0171e09b17042740944e3a9bdf1a0a73c196da806e3b62cd8cd78b1aaa79848a438c8b67afb409aec054467bcb4755f1e253ca3c7656ad7edf17ac48ffadcc09671c02fba6f2027bc81264ab306fc9c2e601e6474111ea9287495b82c25d82689ecf3441e0b2b8eee6dcf30128b1b4810c87f88ea28961246cd07683a711d43bf1551b2a6a91986ebf712f4bc280709a1e3164a928d82eed966ef320cce712853d699838648892e9ced9180971e44c524ac8238c25be2344ceda861e51159dcf7195c202afa6c628553c9c1ee5fc6e1237ee4c1def899c66ec11d51157dc9d5fbbba03a904fe067bf0662662d28a0acac99f375072124b63da54c6da9dbbe09467770f26d464418a0fa6615eff0fa5f0c9ae64898c5be6d5bc04a18c70bd84eb6d592b33776e289eac3da35b62a6d8ec5422dc7251aff4619a0724b8167

key = pow(ckey,d,n)

#print hex(key)

ct = base64.b64decode(ct)

ct = 0x750afd4e9fdac920823a16ab22a81a20106b0b21cb251f0a0da93a7b689e7098e6f219f8290873b91be7c2ba5785e75d35ef29564b4464140fd58e57a50fa05f87fda4add22ee5702b205053446364a08c5d9077a116db2b9994f2266e23e5ee92143926efac38871bbccb526011a1d4cf967d8fed0ac15dc702d25255423fe5a8aea6158b610a0254bed7a68a37658e3aab11c49ae76a6675013f477054206bce0fe6f724a0853777d4d887bd6e635439b7e1f43383d89acdb5ab699c297d89e85b259a68c5a6bacb2f1149180b95f76f018f04724a737e858887178af17a13d921d741aae97842e615299209a7116787b9cd1860cff4d15427c177b68b05ed11df73ce50a33515eaa37128819bc470fa8f23c587302fdbb76108d8f4a3df2a747bc09d9051d45759a9ae7e410d65196d154f235b39237a295cde19fcfe1f747f35be641f99fee530edf23eb203f8ee12642ae6f11f4cb1ec59a33c811d7c4ece4a4fd865a6e320f387c6fdf7ab73f3566fbb8643bb1c90282d87802e3accf7e95e78dca959fd8cf2c7eeae1809fc41f49ab06001be766543681c5c89c000ef788c0779014bb07d6f8014e7f22e9fe4227e1029b599e8b616d134516bbd1ba3c47082f8af29eb22e4efdfe40e39f0344b5dfde54f1174fa77a04b4636b284a64de892c46854c7e7bffc6e83d5aaf9cb4d1be7759e4b1bb2faf175516769ea550cb49ff8f8fd21c85c2af0a195a2f541d1aace696e58c5860b1ca78b6f258952d436b1a7986b28353c1318af0fdc90b043127f47f4ee8b310abf876d4f8a989154a901a1f04a7c1c15ab2e25424cbe93dd7884c5625e3ccd899268215b6e7355c5faf797f9a5a96a26493b365901ce5e01db13a5a255f9ca5219c8fd08040f003cd3980fe11a84473fb8e8cd97512b21a72f120b5ae4681bd667ddc285b2b566217ee66f118c9c935ad34a2ff66389b9a6b23ce6510c4ae533c7067c5d8bbdd5fd14b819498a66b26d2f3604ce662b8dfdf8302c592fb8e548fa73ff4605ef7f9e113b207ff8022fad733f7c039634271dd2af18cd5e48cf98a0f3d7e4c942dbacfa28654b05d5cbda0ae979497e1b21c1faa1b4c79544224e03026cbcd8a5df91074bda0df12b8c21f6babce92544c4a43924717016cad3c02f470f3834f255aba711df053fb778697d7c47dd0d5bca2f6107b0a3f2b00b2d08468129eba62913289d4fc4fd670a3fd4f1666a81bcc69a6a7781650a895dea941614e64b6aafe3bc2f33527632484260107db35cd2f7f467963e72bf2ff052949d8ade8b478e31143f4142d4dcda344ea8dd6305897b2fa01412b35755b774f53013584e5becd48ff82b2eee59b33a09f45ff04007348626dcb52f6e9ad89b2f15e9f2915798a123680945f0d3fd7a97008ba5a7486f6bc493204dbad8d5bba33c594fd5fefd6e3781f37fdaf13292964f5b3a2aebefb4b018173ae363da60377259386de04c1e51d26f9ea7cdc7

ct = pow(ct,d,n)
#print hex(ct)

'''
cipher = AES.new(key, AES.MODE_CBC, iv)

m = cipher.decrypt(enc[AES.block_size:])

print m
'''
