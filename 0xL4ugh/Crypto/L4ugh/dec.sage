'''
RSA Common Private Exponent
LLL
https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf
https://eprint.iacr.org/2009/037.pdf
https://github.com/ctfcompfest/compfest13-final/blob/master/cryptography/private/writeup/solve.py
'''

{"option":"1"}

'''
d0 = 206350931733134559046038012666264262159605459477114266661676711718071821567491611833459104662994828663089430087604498122614530857038303243536416583794909145512825702038109758926420015132996412362948521

Ns=[94197250246597982370705396844643503515932460553573983626120173393517660503268655297474603697012737312445858218256405854714069955450401963311893543006217094493508937469497805167571256355139719619029685487996809179708259694137417224263283453285738320197125322247896507992591707680253686046391096480690295151201, 113975832121158089182647315551205084085181501718368870318043598828318809353762032403859035663278617138894321663732151726924943108499963618857610020766601458677917711215952869831891816753479824041128382366582031662329821670569174512538773362191744665155198904324660767113612735029999746434387436990592685444637, 109029623096751263869487377146555821375870088210742951042157805388283914164227545988340849170566436801372200001409089167860932236741864751663216915390069567375472414750704074091284375886806123266064569536350495642225073285140643860042457226372310856136905802701425123952922907899478922460949692172650420392863]

es=[37035204438541382584945963866321422234384515929039984832032294247909627890349395848653912080862899102940101178027760103147141297764322512687286126000209583224767151263628442616252557338988695990291402011698137054794919210520090762898886863953117629761556041483200540171163452668636360171424839287264029764867, 40741553336646670563014729950907182913999406666889432322375804493529253741247060388667028055696344550174949816312805197657996680023342222701496239510938247418731973519865617700134869274847579520786774092829833725881300681108094869611890509407830718683712941794245022643764865596870406539976022914002256045503, 43201525918300107090610272168894139235532066195297890820605957380139289247249656912211290268870091660752595059696872262382185067713317116432689408628729642220937968316782103946203421051233201840758380940907269161364979771956231662766935749272290030298347168438839298664987842775626131497578873225186665979219]
'''
Ns=[51810401514697877432384088414003921017990954112465216563139808845178229214756376631451508843865787004569889978096853675319242714702370267106900213192269383186027340174878952673076348166318786848167979187412296011647308200209434215462708602887152438897224066059110204293323899399646567211894268891561749312651, 54450055574045668821859528648100220587749436474533296647535610952925850006738995905059182032959274837903355974636770882058049163752379338811404926623371431981750045144779417055183953828531969325456240995916490728471942332537012201732759026052901296466882633970603578228468234459009955312112764949373181409459, 129398197327633964244258416841065491222692905568898318090824214033212221109814000217130510789091168252897225801921883007635874951323079802005506083859682988064527680725387558221917057143611108458060405795124778597631816619082385778934899114602933808857940687569156071893135638214030748952794089420781729156869]
es=[18112145727573430524184555640491656473459055489400429959555025188188842928233333217632310903092133127420897186545561742939456666597647961735992521050248029299509009303513502192953067262849675526813463178048937059194557467524854317910829335285972834611360151509982960054182910318111461102272138470104184422943, 161501701588981708333361338599455531172444051598851982012153014650099255093017102782984182862830180144612217198607468579847008225258956060542537872329530839323465230705014119813371173090844097406597162976591758203097169246180392301608827100825398665355592888850174624021485327970423030904927289379763813799, 81333270442195695014815022501821993489475688210190325527429116438452872369262361815572690984118110462970014395019014417541143178725998859230539837610867901112127331570763105389705834271360527030721290694005316765605634958345703397233524262785108603579131968127350145757008002845271712530869030395255864207295]

{"option":"2"}

#payload = 2^333 - 1
payload = 17498005798264095394980017816940970922825355447145699491406164851279623993595007385788105416184430591

#RAND = [15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587568049291492293800615049951495318494958592724705602858676879233994302124445140659791546734810989943170, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587566643006902224826540565392288758924955959332986323844115579385290546124485418798925365327847293899888, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587571195070661149264565692450679057633526259843574220638356988904634529043381284248414745432338698627886, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587566106022909101398389731740153901980312300716487717493723006559548780133067603906830516359129772698830, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587569163096085001136348417235007807048895325685183381353206721858442003436809885045520395013423717833642, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587568939645488133734460826463123128281215949573974953317158270226162420250916723778826057678812467002438, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587567021649577650711030587073913249346330790130463066121302337115590141356777135750100465133439519479772, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587566020303375596454491683117839241955073989195341801650578125784026847327256151521544251575953546108052, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587572738835931114795008412518798210798917377929966411997907710561917009689892553082687586330871250960276, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587566667458848921699486591979266292401778202294893137875877929891618811098311914713950497660573478162418]

RAND = [97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338892921757352211772715829881474363555768881287808983785059000292942856684855597701132291465110261116208, 97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338901051814955697531853716216273662993690777714912395003552750919384375843430607900086101681077194078228, 97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338894120857264479756033077168460224151318953286476477247113868693816155872748511989956792068802572396442, 97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338895778461682126199278545594500194219287829703392141087887764815707442193709092988684792418227329122204, 97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338900121071086000588757605200725536255434679365090161021655409742607694160910929260082504142138409633098, 97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338893826111107491012303323491610329497128928029654589272014145410034297442353558618919449161253074326852, 97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338897903170551954297498556197594861275016888891770684500876389609343163435390923363664417414873230208892, 97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338899430750103522554150097990248344200029923396388387606679210512655616636732378730313979367140646243368, 97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338894781868347246243311390611612037669628141297131420508790212745755942437803856144807660309299922793552, 97490029893599075626930666704652813074102127017571330642492064346160269785683604887526655499102338897813087776912330491328285668569547746956157885536242659975998014188742458432718351506359685307557178]

'''
d_good*user_input + getPrime(666//2)
user_input == payload == 2^333 -1 > getPrime(666//2), so (d_good*user_input + getPrime(666//2))//user_input == d_good + getPrime(666//2)//user_input == d_good !
''' 

paired_data = sorted(zip(es, Ns), key=lambda x: x[1])
#print(paired_data)

Mx = Matrix(ZZ,4,4)
e1 = paired_data[0][0]
N1 = paired_data[0][1]
e2 = paired_data[1][0]
N2 = paired_data[1][1]
e3 = paired_data[2][0]
N3 = paired_data[2][1]

M = int(sqrt(N3))
Mx[0] = [M, e1, e2, e3]
Mx[1] = [0, -N1, 0, 0]
Mx[2] = [0, 0, -N2, 0]
Mx[3] = [0, 0, 0, -N3]

b = Mx.LLL()
b1 = b[0][0]
#print(b1)

d = int(abs(b1)/M)
d = (d<<333) + RAND[0]//payload
print(d)
#print(d0)

#{"option":"3", "d":"200015862319927711558319739766419238589298666379307036261900015713044014881941174144679886217057515642869772739013436230255390705569899263634237793585619079939872094654640423397541787483541865747734963"}
#{"option":"1", "user":"a"}

'''
{'id': 347118, 'isadmin': False, 'username': 'a'}
420b30e6c56c0f57c0f4358d14b8249a295a60fd188ffccb5d8e639ad5dc603ccfaaea37edf7d83d8454afadeaf8637a4480dd8b0bce9b25595c223a8917e875456e2fee25bae2e8e26e6584ab13b6ac

json.dumps({'id': 347118, 'isadmin': False, 'username': 'a'})
'{"id": 347118, "isadmin": false, "username": "a"}'

IV
420b30e6c56c0f57c0f4358d14b8249a
{"id": 347118, "
295a60fd188ffccb5d8e639ad5dc603c
isadmin": false,
cfaaea37edf7d83d8454afadeaf8637a
 "username": "a"
4480dd8b0bce9b25595c223a8917e875
}
456e2fee25bae2e8e26e6584ab13b6ac


#python pwn xor: 639ad5dc60^ true^false

import binascii
x = xor(xor(bytes.fromhex('639ad5dc60'),' true'),'false')
hex_data = binascii.hexlify(x)
258fcbda60

420b30e6c56c0f57c0f4358d14b8249a295a60fd188ffccb5d8e258fcbda603ccfaaea37edf7d83d8454afadeaf8637a4480dd8b0bce9b25595c223a8917e875456e2fee25bae2e8e26e6584ab13b6ac

{"option":"3", "d":"200015862319927711558319739766419238589298666379307036261900015713044014881941174144679886217057515642869772739013436230255390705569899263634237793585619079939872094654640423397541787483541865747734963"}
{"option":"2", "token":"420b30e6c56c0f57c0f4358d14b8249a295a60fd188ffccb5d8e258fcbda603ccfaaea37edf7d83d8454afadeaf8637a4480dd8b0bce9b25595c223a8917e875456e2fee25bae2e8e26e6584ab13b6ac"}

err=b':A\xb4k5\x07=vJV\xac.\xfe\xdbU\xad'
hex_data = binascii.hexlify(err)
b'3a41b46b35073d764a56ac2efedb55ad'

IV = bytes.fromhex('420b30e6c56c0f57c0f4358d14b8249a')^bytes.fromhex('3a41b46b35073d764a56ac2efedb55ad')^'{"id": 347118, "'
binascii.hexlify(xor(xor(bytes.fromhex('420b30e6c56c0f57c0f4358d14b8249a'),bytes.fromhex('3a41b46b35073d764a56ac2efedb55ad')),'{"id": 347118, "'))
b'0368ede9d2511212be95a892d24f5115'

0368ede9d2511212be95a892d24f5115295a60fd188ffccb5d8e258fcbda603ccfaaea37edf7d83d8454afadeaf8637a4480dd8b0bce9b25595c223a8917e875456e2fee25bae2e8e26e6584ab13b6ac

{"option":"3", "d":"200015862319927711558319739766419238589298666379307036261900015713044014881941174144679886217057515642869772739013436230255390705569899263634237793585619079939872094654640423397541787483541865747734963"}
{"option":"2", "token":"0368ede9d2511212be95a892d24f5115295a60fd188ffccb5d8e258fcbda603ccfaaea37edf7d83d8454afadeaf8637a4480dd8b0bce9b25595c223a8917e875456e2fee25bae2e8e26e6584ab13b6ac"}

{"option":"1"}

0xL4ugh{cryptocats_B3b0_4nd_M1ndfl4y3r}
'''
