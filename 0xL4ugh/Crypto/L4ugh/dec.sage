'''
RSA Common Private Exponent
LLL
https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf
https://eprint.iacr.org/2009/037.pdf
https://github.com/ctfcompfest/compfest13-final/blob/master/cryptography/private/writeup/solve.py
'''
#from pwn import *

'''
d0 = 206350931733134559046038012666264262159605459477114266661676711718071821567491611833459104662994828663089430087604498122614530857038303243536416583794909145512825702038109758926420015132996412362948521

Ns=[94197250246597982370705396844643503515932460553573983626120173393517660503268655297474603697012737312445858218256405854714069955450401963311893543006217094493508937469497805167571256355139719619029685487996809179708259694137417224263283453285738320197125322247896507992591707680253686046391096480690295151201, 113975832121158089182647315551205084085181501718368870318043598828318809353762032403859035663278617138894321663732151726924943108499963618857610020766601458677917711215952869831891816753479824041128382366582031662329821670569174512538773362191744665155198904324660767113612735029999746434387436990592685444637, 109029623096751263869487377146555821375870088210742951042157805388283914164227545988340849170566436801372200001409089167860932236741864751663216915390069567375472414750704074091284375886806123266064569536350495642225073285140643860042457226372310856136905802701425123952922907899478922460949692172650420392863]

es=[37035204438541382584945963866321422234384515929039984832032294247909627890349395848653912080862899102940101178027760103147141297764322512687286126000209583224767151263628442616252557338988695990291402011698137054794919210520090762898886863953117629761556041483200540171163452668636360171424839287264029764867, 40741553336646670563014729950907182913999406666889432322375804493529253741247060388667028055696344550174949816312805197657996680023342222701496239510938247418731973519865617700134869274847579520786774092829833725881300681108094869611890509407830718683712941794245022643764865596870406539976022914002256045503, 43201525918300107090610272168894139235532066195297890820605957380139289247249656912211290268870091660752595059696872262382185067713317116432689408628729642220937968316782103946203421051233201840758380940907269161364979771956231662766935749272290030298347168438839298664987842775626131497578873225186665979219]
'''
Ns=[65760028300712393719512875360820568519579823657770059759826767399554136861274765325173061135371829388255094459008916621643077738943547467916602654346759615777046023605352938550026818053195030699301592776975827293619610271152808414708109862390459036981839617710030923159762773489154593287038640662300912537391, 121861134406570394267984302614248804792900343617482333216893017818711090157987942706143232065487666900521262352633324981745652949520968190851923760266817290684217839727366631933169566809455081037561313956523771726993470041446353748730581341293700651527926245965278090870622193912223504559784768742004121771153, 96686502355080291916903329207268245990142836070581427037501453838462984348740749622344205079132662985452117871534202989553005346628069598116437164132464748392606656720573619460884868726218167059483539619519400130809147528499418714526118766950363786981647603594131775180762270638355032815721141127501403402807]
es=[43197356589712871007012083893490383745200570985974520317485178223561403622178781239098954567779401064153226562390512131346396812133672925669875116365084289046122840143317016790795723891732852990733140217348932055520652211317774018292315116305168571979850366591398397794229617286527505107608510825726457952383, 92456224823636892637410355245346499885943787313531715638350501573733259268943098535605413747626237997118020678843170607383621903309154256923281810643928337554070712376721988209225879469409431496798782551231558252421301776896011872969406280397134379540086241528964635382353140898021397086600185113033047395959, 92947062177502067861115115272321333747180098666877161432648981611128230923640162030101973046913543600927894806860458066021251578595412252572535886024984613302168649035750973082802331222051153208906635150096228256989037307037820379576497155108414292482018041343908830125003575067635799868400091344112528455239]

#payload = 2^333 - 1
payload = 17498005798264095394980017816940970922825355447145699491406164851279623993595007385788105416184430591

#RAND = [15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587568049291492293800615049951495318494958592724705602858676879233994302124445140659791546734810989943170, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587566643006902224826540565392288758924955959332986323844115579385290546124485418798925365327847293899888, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587571195070661149264565692450679057633526259843574220638356988904634529043381284248414745432338698627886, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587566106022909101398389731740153901980312300716487717493723006559548780133067603906830516359129772698830, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587569163096085001136348417235007807048895325685183381353206721858442003436809885045520395013423717833642, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587568939645488133734460826463123128281215949573974953317158270226162420250916723778826057678812467002438, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587567021649577650711030587073913249346330790130463066121302337115590141356777135750100465133439519479772, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587566020303375596454491683117839241955073989195341801650578125784026847327256151521544251575953546108052, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587572738835931114795008412518798210798917377929966411997907710561917009689892553082687586330871250960276, 15513663700834955821252944300732666207908906629638457220661970526026453821641377288405473216277587566667458848921699486591979266292401778202294893137875877929891618811098311914713950497660573478162418]

RAND = [134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254787666651219393900421076801058452193499595287019711893632687137058267927474207567252655321231949755012, 134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254787335163115723096242854068761741289034997309653794915153179558375825760920850268609104567882904372590, 134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254791357557233129235203818950522533541870271325340228577867665560365032647902522698869833927074773030650, 134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254785467942330799669113983929971011532044654895408805204388250888000930813313361102742985306169228471104, 134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254791842886560658018815167986827831435962039932096559137724795123841389268843217705208345143845130965322, 134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254789086759605011608372158602078526824091629793730238215576637085237250583897794088742741415809152811800, 134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254787931118525739965260462071238901355129890804853659570372864693996091994987024319806305330279891953710, 134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254789137946325474623459021941866346066052624621625303008730759051044979188874944874418627882034697437884, 134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254785822218348517186547872588648691653945517653808498242401512736572313511371501730903049152454351629144, 134289375416036641145130841119672662719330376559295096638355881796851554533287494511152826715617254788803143230839497675515173126367894590696309937063673941380873077999498399717827503659832298437640226]

'''
d_good*user_input + getPrime(666//2)
user_input == payload == 2^333 -1 > getPrime(666//2), so (d_good*user_input + getPrime(666//2))//user_input == d_good + getPrime(666//2)//user_input == d_good !
''' 

paired_data = sorted(zip(es, Ns), key=lambda x: x[1])
#print(paired_data)

Mx = Matrix(ZZ,4,4)
e1 = paired_data[0][0]
N1 = paired_data[0][1]
e2 = paired_data[1][0]
N2 = paired_data[1][1]
e3 = paired_data[2][0]
N3 = paired_data[2][1]

M = int(sqrt(N3))
Mx[0] = [M, e1, e2, e3]
Mx[1] = [0, -N1, 0, 0]
Mx[2] = [0, 0, -N2, 0]
Mx[3] = [0, 0, 0, -N3]

b = Mx.LLL()
b1 = b[0][0]
#print(b1)

d = int(abs(b1)/M)
d = (d<<333) + RAND[0]//payload
print(d)
#print(d0)

#{"option":"3", "d":"285350457069974294224383044323128657899188904972223151818408310187651402346197846688495586064244343023543886912793706010700260183533578386496640988768676461320463736202876807376655438360060373841212749"}
#{"option":"1", "user":"a"}

'''
{'id': 405221, 'isadmin': False, 'username': 'a'}
1fc76c8a787be1bc1dc694c31a4b735d164f948d9ef160ce6193fc5d91ba80c0bf0eb99ad7cbe9ed2533a4669d96bb9b30f044f6f04a358d14d6b5f13c0d4b2c50380dbe26e082c1d93862f8b6ef6164

IV
1fc76c8a787be1bc1dc694c31a4b735d
{'id': 405221, '
164f948d9ef160ce6193fc5d91ba80c0
isadmin': False,
bf0eb99ad7cbe9ed2533a4669d96bb9b
 'username': 'a'
30f044f6f04a358d14d6b5f13c0d4b2c
}
50380dbe26e082c1d93862f8b6ef6164


#python pwn xor: fc5d91ba80^ true^false

import binascii
x = xor(xor(bytes.fromhex('fc5d91ba80'),' true'),'false')
hex_data = binascii.hexlify(x)
ba488fbc80

1fc76c8a787be1bc1dc694c31a4b735d164f948d9ef160ce6193ba488fbc80c0bf0eb99ad7cbe9ed2533a4669d96bb9b30f044f6f04a358d14d6b5f13c0d4b2c50380dbe26e082c1d93862f8b6ef6164

{"option":"3", "d":"285350457069974294224383044323128657899188904972223151818408310187651402346197846688495586064244343023543886912793706010700260183533578386496640988768676461320463736202876807376655438360060373841212749"}
{"option":"2", "token":"1fc76c8a787be1bc1dc694c31a4b735d164f948d9ef160ce6193ba488fbc80c0bf0eb99ad7cbe9ed2533a4669d96bb9b30f044f6f04a358d14d6b5f13c0d4b2c50380dbe26e082c1d93862f8b6ef6164"}
'''


